<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Snoopy sweet snacks</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f0f0f0;
      font-family: "Gill Sans", Calibri, sans-serif;
    }
    canvas {
      display: none;
      background: #000;
    }
    .contenedor {
      width: 400px;
    }
    .envoltura-sobre {
      position: relative;
      background-color: #d8a0f0;
      box-shadow: 0 0 40px rgba(0,0,0,0.2);
      border-radius: 15px;
    }
    .sobre {
      position: relative;
      width: 100%;
      height: 300px;
    }
    .carta {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 100%;
      background-color: #fff;
      text-align: center;
      padding: 20px;
      border-radius: 10px;
    }
    .contenido {
      color: #333;
      font-size: 14px;
      text-align: left;
      line-height: 1.4em;
      height: 80%;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .btn-aceptar {
      background: #a020f0;
      color: white;
      border: none;
      padding: 8px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn-aceptar:hover { background: #8000c0; }

    /* Controles t√°ctiles */
    #mobileControls {
      display: none;
      position: fixed;
      bottom: 20px;
      width: 100%;
      justify-content: space-around;
      padding: 0 30px;
      z-index: 1000;
    }
    #mobileControls button {
      width: 100px;
      height: 100px;
      font-size: 40px;
      border-radius: 20px;
      border: none;
      background: #a020f0;
      color: white;
      
      /* üîπ Evita que se pueda seleccionar el bot√≥n */
      user-select: none;       /* CSS est√°ndar */
      -webkit-user-select: none; /* Safari/Chrome */
      -ms-user-select: none;     /* IE/Edge */
      touch-action: manipulation; /* Mejora respuesta t√°ctil */
    }
    #mobileControls button:active { background: #8000c0; }
  </style>
</head>
<body>

<!-- Pantalla de reglas -->
<div id="intro" class="contenedor">
  <div class="envoltura-sobre">
    <div class="sobre">
      <div class="carta">
        <div class="contenido">
          <h2>üíå Bienvenido a Snoopy sweet snacks</h2>
          <p>
            üéÆ Reglas del juego:<br>
            - En PC mueve a Snoopy con las flechas ‚¨ÖÔ∏è ‚û°Ô∏è.<br>
            - Atrapa las fresas üçì para ganar puntos.<br>
            - Atrapa las cerezas üçí para recuperar una vida (m√°x. 5 vidas).<br>
            - Si dejas caer 5 frutas, pierdes el juego üíî.
          </p>
          <p style="text-align:center; margin-top:15px; font-weight:bold;">
            üéâ ¬°Ahora a divertirse! üéâ <br>
            <span style="font-size:14px; color:#555;">Desarrollado con cari√±o por Pedro Cauich</span>
          </p>
        </div>
        <button class="btn-aceptar" id="btnStart">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<!-- Canvas del juego -->
<canvas id="gameCanvas"></canvas>

<!-- Controles t√°ctiles -->
<div id="mobileControls">
  <button id="leftBtn">‚¨ÖÔ∏è</button>
  <button id="rightBtn">‚û°Ô∏è</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function isMobile() { return /Mobi|Android/i.test(navigator.userAgent); }

// --- IM√ÅGENES ---
const backgroundImg = new Image(); backgroundImg.src = "f1.jpg";
const snoopyImg = new Image(); snoopyImg.src = "i1.png";
const cherryImg = new Image(); cherryImg.src = "i2.jpeg";
const strawberryImg = new Image(); strawberryImg.src = "i3.jpeg";

// --- VARIABLES ---
let player, foods, keysPressed, score, misses, lastSpawn;
let gameStarted = false;
const maxFoods = 2, maxMisses = 5;
const foodSpeedBase = 3, foodSpeedMax = 8, spawnIntervalBase = 1000, spawnIntervalMin = 400;
let foodSpeed = foodSpeedBase, spawnInterval = spawnIntervalBase;

// Ajuste canvas
function resizeCanvas() {
  if(isMobile()){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  } else {
    canvas.width = 700;
    canvas.height = 500;
  }
}

// Inicializa el juego
function resetGame(){
  resizeCanvas();
  const scale = canvas.width / 700;
  player = { 
    width: 80*scale, 
    height: 80*scale, 
    speed: 10*scale,
    x: canvas.width/2 - (80*scale)/2,
    y: isMobile() ? canvas.height - (200*scale) : canvas.height - (100*scale)
  };
  foods = [];
  keysPressed = { left:false, right:false };
  score = 0;
  misses = 0;
  lastSpawn = 0;
}

// Teclado
document.addEventListener("keydown", e=>{
  if(e.code==="ArrowLeft") keysPressed.left=true;
  if(e.code==="ArrowRight") keysPressed.right=true;
});
document.addEventListener("keyup", e=>{
  if(e.code==="ArrowLeft") keysPressed.left=false;
  if(e.code==="ArrowRight") keysPressed.right=false;
});

// Controles t√°ctiles
if(isMobile()){
  document.getElementById("mobileControls").style.display="flex";
  document.getElementById("leftBtn").addEventListener("touchstart", ()=>keysPressed.left=true);
  document.getElementById("leftBtn").addEventListener("touchend", ()=>keysPressed.left=false);
  document.getElementById("rightBtn").addEventListener("touchstart", ()=>keysPressed.right=true);
  document.getElementById("rightBtn").addEventListener("touchend", ()=>keysPressed.right=false);
}

// Colisi√≥n
function collide(a,b){
  return(a.x<b.x+b.width && a.x+a.width>b.x && a.y<b.y+b.height && a.y+a.height>b.y);
}

// Dificultad din√°mica
function updateDifficulty(){
  foodSpeed = Math.min(foodSpeedBase + score*0.2, foodSpeedMax);
  spawnInterval = Math.max(spawnIntervalMin, spawnIntervalBase - score*15);
  foodSpeed += Math.sin(Date.now()/500)*0.5;
}

// Bucle principal
function gameLoop(timestamp){
  if(keysPressed.left && player.x>0) player.x -= player.speed;
  if(keysPressed.right && player.x+player.width<canvas.width) player.x += player.speed;

  updateDifficulty();

  if(!lastSpawn) lastSpawn = timestamp;
  if(timestamp-lastSpawn>spawnInterval && foods.length<maxFoods){
    let type = Math.random()<0.2?{img:cherryImg,life:true}:{img:strawberryImg,life:false};
    let foodSize = 40*(canvas.width/700);
    foods.push({
      x: Math.random()*(canvas.width-foodSize),
      y: -foodSize,
      width: foodSize,
      height: foodSize,
      image: type.img,
      life: type.life
    });
    lastSpawn = timestamp;
  }

  foods.forEach(f => f.y += foodSpeed);
  foods = foods.filter(f=>{
    if(collide(player,f)){
      score++;
      if(f.life) misses = Math.max(0, misses-1);
      return false;
    }
    if(f.y>canvas.height){ misses++; return false; }
    return true;
  });

  if(misses>=maxMisses){
    alert("üíî Game Over! Puntos: "+score);
    resetGame();
  }

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(backgroundImg,0,0,canvas.width,canvas.height);
  ctx.drawImage(snoopyImg, player.x, player.y, player.width, player.height);
  foods.forEach(f => ctx.drawImage(f.image, f.x, f.y, f.width, f.height));

  ctx.fillStyle="#6a0dad";
  ctx.font = `${28*(canvas.width/700)}px Comic Sans MS`;
  ctx.textAlign="center";
  ctx.fillText("Snoopy sweet snacks", canvas.width/2, 35*(canvas.width/700));

  ctx.textAlign="left";
  ctx.fillStyle="black";
  ctx.font = `${20*(canvas.width/700)}px Arial`;
  ctx.fillText("Puntos: "+score, 10, 65*(canvas.width/700));
  ctx.fillText("Vidas: "+(maxMisses-misses), 10, 90*(canvas.width/700));

  requestAnimationFrame(gameLoop);
}

// --- INICIO ---
document.getElementById("btnStart").addEventListener("click", ()=>{
  document.getElementById("intro").style.display = "none";
  canvas.style.display = "block";
  resetGame();
  gameStarted = true;
  requestAnimationFrame(gameLoop);
});

// Ajuste al redimensionar
window.addEventListener("resize", ()=>{
  if(gameStarted){
    resizeCanvas();
    const scale = canvas.width / 700;
    player.width = 80*scale;
    player.height = 80*scale;
    player.speed = 10*scale;
    player.x = canvas.width/2 - player.width/2;
    player.y = isMobile() ? canvas.height - (200*scale) : canvas.height - (100*scale);
  }
});
</script>

</body>
</html>
